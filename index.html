<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>宝宝舒适度计算器</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 1rem; background: #f9fafb; }
    h2 { text-align: center; }
    .input-area, .result { 
      margin: 1rem 0; padding: 1rem; 
      background: white; border-radius: 12px; 
      box-shadow: 0 2px 6px rgba(0,0,0,0.1); 
    }
    input { width: 100%; padding: 0.6rem; margin: 0.4rem 0; font-size: 1rem; }
    button { 
      width: 100%; padding: 0.8rem; 
      background: #4CAF50; color: white; border: none; 
      border-radius: 10px; font-size: 1rem; cursor: pointer; 
    }
    button:hover { background: #45a049; }
    .results { display: flex; justify-content: space-between; }
    .card { flex: 1; margin: 0.5rem; padding: 0.8rem; border-radius: 12px; background: #f0fdf4; text-align: center; }
    .emoji { font-size: 2rem; }
    .upload { margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>宝宝舒适度计算器 😊</h2>

  <div class="input-area">
    <label>温度</label>
    <input id="temp" type="number" inputmode="decimal" placeholder="输入温度">
    <label>相对湿度</label>
    <input id="rh" type="number" inputmode="decimal" placeholder="输入相对湿度">
    <label>绝对湿度</label>
    <input id="ah" type="number" inputmode="decimal" placeholder="输入绝对湿度">
    <label>露点温度</label>
    <input id="dew" type="number" inputmode="decimal" placeholder="输入露点温度">
    <label>饱和水汽压差 (VPD)</label>
    <input id="vpd" type="number" inputmode="decimal" placeholder="输入VPD">
    <button onclick="calculate()">计算舒适度</button>

    <div class="upload">
      <p>或上传截图自动识别：</p>
      <input type="file" accept="image/*" onchange="handleImage(this.files[0])">
    </div>
  </div>

  <div class="result" id="result"></div>

  <script>
    function calculate() {
      const temp = parseFloat(document.getElementById("temp").value) || 0;
      const rh = parseFloat(document.getElementById("rh").value) || 0;
      const ah = parseFloat(document.getElementById("ah").value) || 0;
      const dew = parseFloat(document.getElementById("dew").value) || 0;
      const vpd = parseFloat(document.getElementById("vpd").value) || 0;

      const results = {
        quiet: temp - (0.2 * (100 - rh) / 5),
        auto: temp - (0.5 * (100 - rh) / 5)
      };

      const comfort = (t, r, v) => {
        if (t >= 22 && t <= 26 && r >= 40 && r <= 65 && v >= 0.5 && v <= 1.5) {
          return "😊 舒适，宝宝安心";
        } else if (t < 20 || t > 28) {
          return "🥶🥵 温度不合适，需调整空调或衣物";
        } else if (r < 35) {
          return "💨 空气偏干，注意加湿";
        } else if (r > 70) {
          return "💦 湿度过高，注意除湿";
        } else {
          return "😐 一般，建议观察宝宝状态";
        }
      };

      document.getElementById("result").innerHTML = `
        <div class="results">
          <div class="card">
            <div class="emoji">🌙</div>
            <p>静音模式</p>
            <p>体感温度: ${results.quiet.toFixed(1)}</p>
            <p>${comfort(temp, rh, vpd)}</p>
          </div>
          <div class="card">
            <div class="emoji">💨</div>
            <p>自动模式</p>
            <p>体感温度: ${results.auto.toFixed(1)}</p>
            <p>${comfort(temp, rh, vpd)}</p>
          </div>
        </div>
        <div class="card">
          <div class="emoji">👕</div>
          <p>睡觉建议：${sleepAdvice(temp)}</p>
        </div>
      `;
    }

    function sleepAdvice(temp) {
      if (temp < 20) return "长袖+睡袋";
      if (temp < 24) return "长袖薄睡袋";
      if (temp < 27) return "短袖睡袋";
      return "轻薄短袖";
    }

    // ---- OCR 识别并提取 ----
    async function handleImage(file) {
      const { data: { text } } = await Tesseract.recognize(file, 'chi_sim+eng', {
        tessedit_char_whitelist: '0123456789.%'
      });

      console.log("OCR结果:", text);

      function extractValue(keyword) {
        const regex = new RegExp(keyword + '\\s*([0-9]+\\.?[0-9]*)');
        const match = text.match(regex);
        return match ? parseFloat(match[1]) : '';
      }

      document.getElementById("temp").value = extractValue("温度");
      document.getElementById("rh").value = extractValue("相对湿度");
      document.getElementById("ah").value = extractValue("绝对湿度");
      document.getElementById("dew").value = extractValue("露点温度");
      document.getElementById("vpd").value = extractValue("VPD");

      calculate();
    }
  </script>
</body>
</html>
